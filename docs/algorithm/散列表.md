## 概念

散列表也叫作哈希表(hash table)，这种数据结构提供了键(Key)和值(Value)的映射关系。只要 给出一个Key，就可以高效查找到它所匹配的Value，时间复杂度接近于O(1)。

![image-20210402102250998](https://elgchat-oss.oss-accelerate.aliyuncs.com/elgchat/2021_04_02/image-20210402102250998.png)

## 存储原理

散列表在本质上也是一个**数组**

散列表的Key则是以字符串类型为主的 

通过hash函数把Key和数组下标进行转换 

作用是把任意长度的输入通过散列算法转换成固定类型、固定长度的散列值

![image-20210402104118789](https://elgchat-oss.oss-accelerate.aliyuncs.com/elgchat/2021_04_02/image-20210402104118789.png)

在Java中计算hash函数

```java
//数组下标=取key的hashcode模数组的长度后的余数 
index = HashCode (Key) % Array.length
int index=Math.abs("Hello".hashCode())%10;//0-9
```

这是最简单的计算方式

还有很多hash函数:CRC16、CRC32、siphash 、murmurHash、times 33等 

此种Hash计算方式为固定Hash方式，也称为传统Hash 

该方式在数组固定时，可以快速检索 

但当数组长度变化时，需要重新计算数组下标，此时根据key检索将出现问题 

所以说传统Hash法虽然比较简单，但不利于扩展，如果要扩展可以采用一致性Hash法

## 操作

### 写操作（Put）

写操作就是在散列表中插入新的键值对(在JDK中叫作Entry或Node)

1. 通过hash函数计算hashcode，将key转换成数组下标
2. 数组下标对应位置不存在元素，则将Entry填充到这个数组下标位置

![image-20210402112436560](https://elgchat-oss.oss-accelerate.aliyuncs.com/elgchat/2021_04_02/image-20210402112436560.png)



### 哈希冲突

由于数组长度有限且计算hashcode时转换对应坐标位置，可能会导致不同key指向同一下标，如果数组当前下标已经存在元素，那么此时就发生了**哈希冲突**

![image-20210402112757097](https://elgchat-oss.oss-accelerate.aliyuncs.com/elgchat/2021_04_02/image-20210402112757097.png)

哈希冲突的解决方式主要有两种：

#### 开放寻址法

开放寻址法的原理是当一个Key通过哈希函数获得对应的数组下标已被占用时，就寻找下一个空档位置

在Java中，ThreadLocal所使用的就是开放寻址法

![image-20210402113440914](https://elgchat-oss.oss-accelerate.aliyuncs.com/elgchat/2021_04_02/image-20210402113440914.png)

#### 链表法

数组的每一个元素不仅是一个Entry对象，还是一个链表的头节点。每一个Entry对象通过next指针 指向它的下一个Entry节点。当新来的Entry映射到与之冲突的数组位置时，只需要插入到对应的链 表中即可，默认next指向null

![image-20210402115116913](https://elgchat-oss.oss-accelerate.aliyuncs.com/elgchat/2021_04_02/image-20210402115116913.png)

在Entry中保存key和值，以及next指针

```java
Entry{
    int key;
    Object value;
		Entry next; 
}
```

当根据key查找值的时候，在index=2的位置是一个单链表 遍历该单链表，再根据key即可取值

### 读操作（Get）

读操作就是通过给定的Key，在散列表中查找对应的Value 

1. 通过哈希函数，把Key转化成数组下标 

2. 找到数组下标所对应的元素，如果key不正确，说明产生了hash冲突， 则顺着头节点遍历该单链表，再根据key即可取值

![image-20210402120854884](https://elgchat-oss.oss-accelerate.aliyuncs.com/elgchat/2021_04_02/image-20210402120854884.png)

### Hash扩容（resize）

待补充